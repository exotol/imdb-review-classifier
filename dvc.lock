schema: '2.0'
stages:
  data_split:
    cmd: python -m imdb_review_classifier.pipelines.data_split --path_to_config=configs/baseline.yaml
    deps:
    - path: data/raw/imdb_dataset.csv
      md5: 308443a50e5c993e7b8a1cdb95750026
      size: 66212309
    - path: imdb_review_classifier/pipelines/data_split.py
      md5: 71e490535a9201dbdad67757bf68893f
      size: 1213
    params:
      configs/baseline.yaml:
        base:
          seed: 100500
        data_split:
          raw_data: data/raw/imdb_dataset.csv
          test_size: 0.2
          train_path: data/split/train.csv
          test_path: data/split/test.csv
    outs:
    - path: data/split/test.csv
      md5: 4279918fa2315ab43852446f5b846215
      size: 13193722
    - path: data/split/train.csv
      md5: e91174c30f08e589561364b57e63f404
      size: 53018604
  features:
    cmd: python -m imdb_review_classifier.pipelines.featurize  --path_to_config=configs/baseline.yaml
    deps:
    - path: data/split/train.csv
      md5: e91174c30f08e589561364b57e63f404
      size: 53018604
    - path: imdb_review_classifier/pipelines/featurize.py
      md5: 10ce04a135b5d028a2f7f079fe98ff91
      size: 1492
    params:
      configs/baseline.yaml:
        data_split:
          raw_data: data/raw/imdb_dataset.csv
          test_size: 0.2
          train_path: data/split/train.csv
          test_path: data/split/test.csv
        features:
          vectorizer:
            analyzer: word
            min_df: 3
          save:
            model_file_name: models/count_vectorizer
            train_data_file: data/features/x_train
            target_train_file: data/features/y_train
            train_data: data/features/train
    outs:
    - path: data/features/train
      md5: 972d5e51884a564a513354d7a0718bb6
      size: 69608171
    - path: models/count_vectorizer
      md5: a3d91c7a7214d8a167ec90a680c0e9a2
      size: 1760001
  train:
    cmd: python -m imdb_review_classifier.pipelines.train  --path_to_config=configs/baseline.yaml
    deps:
    - path: data/features/train
      md5: 972d5e51884a564a513354d7a0718bb6
      size: 69608171
    - path: imdb_review_classifier/pipelines/train.py
      md5: 4dbf12e7842ab8f87cf7fdf383745a5a
      size: 1290
    params:
      configs/baseline.yaml:
        base:
          seed: 100500
        features:
          vectorizer:
            analyzer: word
            min_df: 3
          save:
            model_file_name: models/count_vectorizer
            train_data_file: data/features/x_train
            target_train_file: data/features/y_train
            train_data: data/features/train
        train:
          model:
            type: LinearSVC
          save:
            model_path: models/lin_svc
    outs:
    - path: models/lin_svc
      md5: 25c923e4097a68ccb744460bcb69e83c
      size: 521967
  evaluate:
    cmd: python -m imdb_review_classifier.pipelines.evaluate --path_to_config=configs/baseline.yaml
    deps:
    - path: data/split/test.csv
      md5: 4279918fa2315ab43852446f5b846215
      size: 13193722
    - path: imdb_review_classifier/pipelines/evaluate.py
      md5: 9e9f31ae015a2ec6f7e8f0006dfbafff
      size: 1540
    - path: models/count_vectorizer
      md5: 8d8edbaa77d3179b825580d2b03421ae
      size: 1760001
    - path: models/lin_reg
      md5: 72fe901758140993a7a286079c8f3857
      size: 543855
    params:
      configs/baseline.yaml:
        evaluate:
          save:
            metrics_file: report/metrics/metrics.json
            confusion_matrix: report/metrics/cm.csv
        features:
          vectorizer:
            analyzer: word
            min_df: 3
          save:
            model_file_name: models/count_vectorizer
            train_data_file: data/features/x_train
            target_train_file: data/features/y_train
            train_data: data/features/train
        train:
          save:
            model_path: models/lin_reg
    outs:
    - path: report/metrics/cm.csv
      md5: d0e37075fa5793c9409cb8ed6597e62c
      size: 180017
    - path: report/metrics/metrics.json
      md5: e679f38839d2e11f103e1daec24ec051
      size: 20
  eval:
    cmd: python -m imdb_review_classifier.pipelines.evaluate --path_to_config=configs/baseline.yaml
    deps:
    - path: data/split/test.csv
      md5: 4279918fa2315ab43852446f5b846215
      size: 13193722
    - path: imdb_review_classifier/pipelines/evaluate.py
      md5: 85256b75f53749cad74fb3c363c35462
      size: 1533
    - path: models/count_vectorizer
      md5: a3d91c7a7214d8a167ec90a680c0e9a2
      size: 1760001
    - path: models/lin_svc
      md5: 25c923e4097a68ccb744460bcb69e83c
      size: 521967
    params:
      configs/baseline.yaml:
        evaluate:
          save:
            metrics_file: report/metrics/metrics.json
            confusion_matrix: report/metrics/cm.csv
        features:
          vectorizer:
            analyzer: word
            min_df: 3
          save:
            model_file_name: models/count_vectorizer
            train_data_file: data/features/x_train
            target_train_file: data/features/y_train
            train_data: data/features/train
        train:
          model:
            type: LinearSVC
          save:
            model_path: models/lin_svc
    outs:
    - path: report/metrics/cm.csv
      md5: 7fb765749dcd357c3c456cf3ebde51c0
      size: 180017
    - path: report/metrics/metrics.json
      md5: f66056d756f9bdccb54aaa4ad4fb79a3
      size: 20
  build-us:
    cmd: python test.py --thresh 10 --out model-us.hdf5
    params:
      configs/baseline.yaml:
        models.us.filename: model-us.hdf5
        models.us.threshold: 10
    outs:
    - path: model-us.hdf5
      md5: d3d9446802a44259755d38e6d163e820
      size: 2
